
# Compile css, js assets
asset-watcher:
  build: asset-pipeline
  volumes:
  - "./app-client:/opt/devwebapp/app-client"
  command: npm run watch

# Development server
app-server:
  build: app-server
  links:
  - db
  - static
  volumes:
  - ./app-server/scootme:/opt/devwebapp/app-server/scootme
  command: python scootme/serve.py
  ports:
  - "8000:8000"
  environment:
    STATIC_BASE: 'http://192.168.99.100:8001'

# DB migration container
migrator:
  build: app-server
  links:
  - db
  volumes:
  - ./app-server/scootme:/opt/devwebapp/app-server/scootme
  environment: 
    POSTGRES_PASSWORD: fastidious
  command: echo "Migrate only container (run manually to migrate)"

# Data container for DB
dataonly:
  image: debian:wheezy
  volumes:
  - /var/lib/postgresql/data/                     # Persistent database data
  command: echo "Data only container"

# SQL Database
db:
  image: postgres:9.4.4
  environment: 
    POSTGRES_PASSWORD: fastidious
  volumes_from:
  - dataonly # For database persistence

# Static content server
static:
  image: nginx:1.9.5
  volumes:
  - ./app-client/build:/usr/share/nginx/html:ro
  ports:
  - "8001:80"